---
/**
 * Plan Overview Page
 * Dynamic route for viewing plan details
 * Path: /plans/{id}
 */

import Layout from "@/layouts/Layout.astro";
import { PlanOverviewContent } from "@/components/planOverview/PlanOverviewContent";

// SSR Guard: Redirect to login if not authenticated
const { user } = Astro.locals;

if (!user) {
  const redirectUrl = `/auth/login?next=${encodeURIComponent(Astro.url.pathname)}`;
  return Astro.redirect(redirectUrl);
}

// Get plan ID from URL params
const { id } = Astro.params;

// Validate plan ID
if (!id || isNaN(Number(id))) {
  return Astro.redirect("/dashboard");
}

const planId = Number(id);
---

<Layout title={`Plan #${planId}`}>
  <PlanOverviewContent client:load planId={planId} />
</Layout>
